{% extends "saas/base_dashboard-2col.html" %}

{% block saas_title %}Theme{% endblock %}

{% block saas_help %}
<p>
When you are modifying root templates (ex: <filename>base.html</filename>),
you may inadvertently break the dashboard and become unable to access this
page to upload a fix.
</p>
<p>
You can reset to the default theme, but you will need
<a href="{{urls.user.profile_redirect}}">an API key</a> to trigger
the <a href="https://djaodjin.com/docs/djaoapp-api/#themes_delete">API end point</a>
from the command line.
</p>
<pre class="code"><code>curl -i -u *api_key*: -X DELETE https://{{site_available_at_url}}/api/themes/</code></pre>
<p>
<a target="_blank" href="https://djaodjin.com/docs/themes/">Read more about theme customization ... &raquo;</a>
</p>
{% endblock %}

{% block saas_content %}
<div id="themes">
  <div class="mt-4">
    <div id="theme-upload" class="pages-upload"
         data-complete-url="{{urls.pages.api_themes}}"
         djupload-success >
      <div class="dropzone-previews previewsContainer">
        <span class="dz-default dz-message"><i class="fa fa-cloud"></i> Upload theme package (.zip)</span>
      </div>
    </div>
    <div class="text-center">
      <a id="download-theme" class="btn btn-secondary" href="{{urls.pages.theme_download}}" target="_blank"><i class="fa fa-cloud-download"></i> Download as .zip file</a>
      <button id="reset-theme" class="btn btn-danger">Reset to default</button>
    </div>
  </div>
</div>

<section id="notifications" class="mt-5">
  <h1 class="mb-4">Notifications</h1>
  {% for key, vals in notifications.items() %}
  <div id="{{key}}" class="card mb-3">
    <div class="card-body">
      <h5 class="card-title"><a href="{{urls.notifications}}{{key}}/">{{vals.title}}</a></h5>
      <p class="card-text">
{{vals.descr}}
      </p>
      <a href="{{urls.notifications}}{{key}}/" class="btn btn-primary">Edit</a>
      <button class="btn btn-outline-secondary send-test-email">Send test e-mail</button>
      <!--<button class="btn btn-secondary" data-toggle="collapse" data-target="#collapse-{{key}}">Edit</button>
        <div class="collapse" id="collapse-{{key}}">
          <div class="card my-4">
            <div class="card-body">
              <p class="card-text">
                Editor here
              </p>
            </div>
          </div>
        </div>-->
    </div>
  </div>
  {% endfor %}
  {% for role_descr in role_descriptions %}
  <div id="{{role_descr.slug}}_role_added" class="card mb-3">
    <div class="card-body">
      <h5 class="card-title"><a href="{{urls.notifications}}{{role_descr.slug}}_role_added/">{{role_descr.title}} added</a></h5>
      <p class="card-text">
      </p>
      <a href="{{urls.notifications}}{{key}}/" class="btn btn-secondary">Edit</a>
      <button class="btn btn-secondary send-test-email">Send test e-mail</button>
    </div>
  </div>
  {% endfor %}
</section>
{% endblock %}

{% block dashboard_bodyscripts %}
<script type="text/javascript">
jQuery(document).ready(function($) {
  $(".pages-upload").djupload({
      uploadUrl: "{{urls.pages.api_themes}}",
  });
  $("#reset-theme").click(function(event) {
     $.ajax({
         method: "DELETE",
         url: "{{urls.pages.api_themes}}",
         datatype: "json",
         contentType: "application/json; charset=utf-8",
         success: function(resp) {
           showMessages(["reset to default theme"], "success");
         },
         error: function(resp) {
           showErrorMessages(resp);
         }
     });
  });
  $(".send-test-email").click(function(event) {
        var self = this;
        var id = $(self).closest(".card").attr("id");
        $.ajax({
            type: "POST",
            url: "{{urls.send_test_email}}" + id + "/",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("X-CSRFToken", getMetaCSRFToken());
            },
            data: null,
            datatype: "json",
            contentType: "application/json; charset=utf-8",
            success: function(data) { showMessages([data.details], "info"); },
            error: function(resp) { showErrorMessages(resp); },
        });
    });
  });
</script>
{% endblock %}
