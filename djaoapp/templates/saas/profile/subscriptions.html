{% extends "saas/base_dashboard.html" %}

{% block saas_title %}
{{organization.printable_name}} Subscriptions
{% endblock %}

{% block saas_content %}
<section id="subscriptions">
<div id="subscriptions-list-container" data-trip data-trip-index="1" data-trip-content="<h2>Subscriptions</h2><p>List of all your active subscriptions.<br />You can manage all your active subscriptions here.</p><em>Use keyboard navigation or click 'Next' to move forward.</em>" data-trip-position="screen-center">
<div class="table-responsive">
<table class="table">
 <thead>
  <tr>
   <th>Subscribed to</th>
   <th>Until</th>
   <th></th>
   <th></th>
  </tr>
 </thead>
 <tbody>
  {% if plans %}
  <tr>
      <td colspan="5">
          <form id="subscribe" @submit="subscribe('{{organization}}')">
              <div class="input-group">
                  <select class="form-control" name="plan" v-model="plan">
                      <option selected :value="{}">Select a plan...</option>
                      {% for choice in plans %}
                      <option :value='{"slug":"{{choice.slug}}","organization":"{{choice.organization.slug}}"}'>{{choice.title}}</option>
                      {% endfor %}
                  </select>
                  <span class="input-group-btn">
                      <button type="submit" class="btn btn-primary"><i class="fa fa-plus"></i> Subscribe</button>
                  </span>
              </div>
          </form>
      </td>
  </tr>
  {% endif %}
  <tr v-show="!itemsLoaded">
   <td colspan="4">
    <h3  class="text-center"><i class="fa fa-refresh fa-spin fa-2x"></i></h3>
   </td>
  </tr>
  <tr v-show="itemsLoaded && items.count === 0">
   <td colspan="4">
    <h4 class="text-center"><em>No subcriptions</em></h4>
   </td>
  </tr>
 </tbody>
 <tbody v-cloak v-show="itemsLoaded && items.results.length > 0">
  <tr ng-class="endsSoon(entry)" v-for="(entry, index) in items.results">
   <td><a :href="entry.plan.app_url + entry.organization.slug + '/' + entry.plan.slug + '/'">[[entry.plan.title]]</a></td>
   <td class="date">
    <uiv-dropdown class="form-group" v-if="entry.editable" append-to-body>
      <btn class="dropdown-toggle"><i class="fa fa-calendar"></i></btn>
      <template slot="dropdown">
        <li>
          <uiv-date-picker
            v-model="entry.ends_at"
            v-on:input="selected(index)"
            icon-control-left="fa fa-caret-left"
            icon-control-right="fa fa-caret-right" />
        </li>
      </template>
    </uiv-dropdown>
       <span>
           [[entry.ends_at ? ($options.filters.formatDate(entry.ends_at, 'MMM D, Y')) : "Never"]]
       </span>
   </td>
   <td>
    [[entry.ends_at | relativeDate]]
   </td>
   <td v-if="!entry.request_key" style="text-align: right;">
       <button class="btn btn-danger unsubscribe"
            @click="unsubscribeConfirm(entry.organization.slug, entry.plan.slug)">
           Unsubscribe Now
       </button>
   </td>
   <td v-if="entry.request_key && entry.editable" style="text-align: right;">
       <button class="btn btn-danger unsubscribe"
            @click="unsubscribeConfirm(entry.organization.slug, entry.plan.slug)">
           Deny
       </button>
       <button class="btn btn-primary"
               @click="acceptRequest(entry.plan.organization, entry.request_key)">
           Accept
       </button>
   </td>
   <td v-if="entry.request_key && !entry.editable" style="text-align: right;">
       Request pending approval ...
   </td>
  </tr>
 </tbody>
</table>
</div>
<div class="text-center" v-show="itemsLoaded && totalItems > itemsPerPage">
    <uiv-pagination v-model="currentPage" :total-page="pageCount" v-on:change="get" size="sm" boundary-links/>
</div>
<!-- modal dialog to confirm unsubscribe -->
<modal v-model="modalOpen" title="Unsubscribe ...">
    <p>
        You are about to delete the profile and account
        for <em>{{organization.printable_name}}</em>.
        This operation cannot be reversed.
    </p>
    <p>
        Are you sure you want to continue?
    </p>
    <div slot="footer">
        <button id="cancel-unsubscribe"
                class="btn btn-default"
                @click="modalOpen=false">Cancel</button>
        <button type="submit" id="unsubscribe-btn"
                class="btn btn-danger"
                @click="unsubscribe">Unsubscribe</button>
    </div>
</modal>
<!-- /modal dialog to confirm unsubscribe -->
</div> <!-- /controller -->
</section>
{% endblock %}
