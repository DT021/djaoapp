{% extends "saas/base_dashboard.html" %}

{% block saas_title %}
{{title}} for {{organization.printable_name}}
{% endblock %}

{% block saas_content %}
<style>
.chart-area{
  height: 400px !important;
  width: 100%;
}
</style>

<section id="metrics-container">
    <div data-trip data-trip data-trip-index="1" data-trip-content="<p>Track monthly revenue and monthly subscribers.</p><em>Use keyboard navigation or click 'Next' to move forward.</em>" data-trip-position="screen-center">
        <tabs v-model="currentTab" :transition-duration="0" @change="prepareCurrentTabData">
            <tab v-for="tab in tables" v-bind:title="tabTitle(tab)" v-bind:key="tab.key">
                <div class="date-chooser pull-right">
                  <span>To</span>
                  <select  class="form-control" v-model="timezone" @change="prepareCurrentTabData" style="display:inline-block; width:80px;">
                    <option value="local">Local</option>
                    <option value="utc">UTC</option>
                  </select>
                    <uiv-dropdown class="form-group" append-to-body menu-right>
                      <btn class="dropdown-toggle"><i class="fa fa-calendar"></i></btn>
                      <template slot="dropdown">
                        <li>
                          <uiv-date-picker
                            v-model="ends_at"
                            v-on:input="prepareCurrentTabData"
                            icon-control-left="fa fa-caret-left"
                            icon-control-right="fa fa-caret-right" />
                        </li>
                      </template>
                    </uiv-dropdown>
                  <span class="date" data-trip data-trip data-trip-index="2" data-trip-content="<p>Look back through time.</p>" data-trip-position="s">[[ends_at | formatDate('MMM D, Y')]]</span>
                </div>
                <div :id="'metrics-chart-' + tab.key" class="chart-content">
                  <h3  class="text-center"><i class="fa fa-refresh fa-spin fa-2x"></i></h3>
                </div>
                <!-- Display as a table -->
                <div class="table-responsive">
                    <table class="table" style="font-size:0.7em;">
                      <tr>
                        <td></td>
                        <td v-for="col in currentTableDates">[[col[0] | monthHeading]]</td>
                      </tr>
                      <tr v-for="row in currentTableData.data" :key="row.key">
                        <td v-if="row.location"><span :class="{ 'text-success': row.is_active, 'text-danger': !row.is_active }"><i class="fa fa-circle"></i></span> <a :href="row.location">[[row.key]]</a></td>
                        <td v-if="!row.location">[[row.key]]</td>
                        <td v-for="col in row.values" :key="col[0].toISOString()" :title="col[1]|humanizeCell(currentTableData.unit, currentTableData.scale, false)">[[col[1]|humanizeCell(currentTableData.unit, currentTableData.scale)]]</td>
                      </tr>
                      {% block metrics_extra_data %}
                      {% endblock %}
                    </table>
                </div>
            </tab>
        </tabs>
    </div>
</section>
{% endblock %}

{% block dashboard_bodyscripts %}
<script type="text/javascript">
jQuery(document).ready(function($) {
    // Copy/Paste from vendor/js/bootstrap.js and inserted
    // a forced trigger of 'resize' for NVD3 to redraw the chart
    // using correct dimensions.
    $(document).on('shown.bs.tab', '[data-toggle="tab"], [data-toggle="pill"]',
        function (e) {
        window.dispatchEvent(new Event('resize'));
    });
});
</script>
{% endblock %}
